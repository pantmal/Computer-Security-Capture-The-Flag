## 2021 Project 2

![](logo.png)

Ερωτήσεις:

1. Πού βρίσκεται ο Γιώργος;
1. Ποιος έκλεψε τα αρχεία του "Plan X";
1. Πού βρίσκονται τα αρχεία του "Plan X";
1. Ποια είναι τα results του "Plan Y";
1. Ποιο είναι το code του "Plan Z";




#### Παρατηρήσεις

- Οι ίδιες ομάδες με την εργασία 1
- Εγγραφή στο github: https://classroom.github.com/g/jlkOQHdH 
- Μόλις ολοκληρώσετε κάθε βήμα στέλνετε claim στο ys13@chatzi.org
- Για τα βήματα 3-5 απαιτείται να γράψετε ένα πρόγραμμα που να αυτοματοποιεί την εύρεση της λύσης.
  Μπορείτε να χρησιμοποιήσετε ό,τι γλώσσα προγραμματισμού θέλετε, αλλά θα πρέπει να μπορώ να το τρέξω
  σε Ubuntu 20.04 χρησιμοποιώντας software που είναι διαθέσιμο στο Ubuntu. Θα πρέπει επίσης
  να φτιάξετε ένα script `run.sh` που εκτελεί το πρόγραμμα με ό,τι παραμέτρους χρειάζονται.
- Επίσης γράφετε report στο README.md με τα βήματα που ακολουθήσατε, και το κάνετε commit μαζί με οποιοδήποτε κώδικα χρησιμοποιήσατε
- Βαθμολογία
    - Η δυσκολία στα βήματα αυξάνεται απότομα.
    - Για ό,τι δεν ολοκληρώσετε περιγράψτε (και υλοποιήστε στο πρόγραμμα) την πρόοδό σας και πώς θα μπορούσατε να συνεχίσετε.
    - Με τα πρώτα 2 βήματα παίρνετε 5 στο μάθημα (αν έχετε πάει καλά στην εργασία 1)
    - Με τα 3-5 φτάνετε μέχρι το 10 (δεν υπάρχει γραπτή εξέταση)
    - Για τους μεταπτυχιακούς τα 3-5 είναι προαιρετικά. ΔΕΝ αντικαθιστούν το project
     (αλλά μπορούν να λειτουργήσουν προσθετικά στο βαθμό της εργασίας 1)
    - Για τα βήματα 3-5 μπορεί να γίνει προφορική εξέταση
- Timeline
    - Την πρώτη εβδομάδα δεν υπάρχουν hints
    - 11/6: αρχίζουν τα hints για τα βήματα 1,2
    - 16/6: deadline για τα βήματα 1,2
    - Για τα βήματα 3-5 δίνονται hints μόνο σε όσους ζητήσουν (με μικρό penalty)
    - 11/7: deadline για τα βήματα 3-5
- Η ταχύτητα των λύσεων (και ο αριθμός hints που έχουν δοθεί) μετράει στο βαθμό
(ειδικά για τα βήματα 1,2)

- __Οχι spoilers__
- __Οχι DoS__ (ή μαζικά requests, δε χρειάζεται
κάτι τέτοιο)

## Report

1. Πού βρίσκεται ο Γιώργος;

Για να βρούμε τον Γιώργο ξεκινήσαμε την αναζήτηση μας πληκτρολογώντας το onion site που βρίσκεται στην φωτογραφία της εκφώνησης (2bx6yarg76ryzjdpegl5l76skdlb4vvxwjxpipq4nhz3xnjjh3jo6qyd.onion). Σύντομα παρατηρήσαμε ότι το visitor number στην σελίδα έχει κάποια ιδιαιτερότητα. Συγκεκριμένα ο αριθμός του επισκέπτη καθορίζεται από το cookie που είναι encoded σε base64. Στην αρχή δεν μας φάνηκε χρήσιμο οπότε το αφήσαμε στην άκρη.

Στην συνέχεια ανοίξαμε τον πηγαίο κώδικα της σελίδας και αξιοποιήσαμε το hint με το link που ήταν στα σχόλια (https://blog.0day.rocks/securing-a-web-hidden-service-89d935ba1c1d). Από το link μάθαμε ότι προσθέτοντας στο URL: /server-info μπορούμε να έχουμε πρόσβαση στα internal settings του site. Από εκεί είδαμε ότι υπάρχει και μια άλλη σελίδα (flffeyo7q6zllfse2sgwh7i5b5apn73g6upedyihqvaarhq5wrkkn7ad.onion) η οποία λειτουργεί ως προσωπική σελίδα για τους admins του πρώτου site.

Μετά μάθαμε ότι γενικά αρκετά websites χρησιμοποιούν ένα robots.txt αρχείο για να αποκλείσουν την πρόσβαση σε συγκεκριμένες σελίδες από web crawlers. Αφού βρήκαμε λοιπόν το σχετικό αρχείο, παρατηρήσαμε την αναφορά στα .phps αρχεία. Οπότε δοκιμάσαμε να γράψουμε την κατάληξη .phps για το access.php αρχείο όπου γίνεται ο έλεγχος για την πρόσβαση στο personal site. Εκεί λοιπόν βρήκαμε το source code του access.php. Βρήκαμε λοιπόν την μεταβλητή desired με βάση τα hints που υπήρχαν στα σχόλια (σχετικός κώδικας στο Secret.java αρχείο του φακέλου george_files), η οποία είχε την τιμή 1337 και με το απαραίτητο padding βρήκαμε τελικά ότι ο επιθυμητός χρήστης είναι ο 0001337. Μετά για τον κωδικό δώσαμε βάση στο γεγονός ότι χρησιμοποιείται η συνάρτηση strcmp για την εγκυρότητα του κωδικού. Αναζητήσαμε λοιπόν τρόπους για να κάνουμε exploit την συνάρτηση να επιστρέψει 0. Βρήκαμε λοιπόν ότι βάζοντας έναν πίνακα ως input (πχ: password[]=a) η strcmp επιστρέφει 0 και άρα περνάει ο έλεγχος.

Από εκεί λοιπόν μπήκαμε στο προσωπικό ιστολόγιο της Υβόννης (flffeyo7q6zllfse2sgwh7i5b5apn73g6upedyihqvaarhq5wrkkn7ad.onion/blogposts7589109238/) και αναλύσαμε τα diary entries. Το δεύτερο entry φαινόταν να αναφέρεται στο Plan X του δεύτερου ερωτήματος, οπότε το αφήσαμε στην άκρη. Δοκιμάσαμε να ελέγξουμε για πιθανά directory listings του φακέλου /blogposts7589109238/blogposts/ και έτσι ανακαλύψαμε την σελίδα post3.html. Εκεί λοιπόν βρήκαμε το hint για τον Γιώργο και αμέσως θυμηθήκαμε το cookie-based hint που είχαμε βρει στην αρχή.

Αφου λοιπόν μετατρέψαμε τον αριθμό 834472 σε sha-256 και αμέσως μετά τον συνδυασμό του αριθμόυ και του hash σε base64 encoding ενημερώσαμε το cookie από το Fixers site με την σωστή τιμή και έτσι βρήκαμε την σελίδα για τα backup αρχεία.

Κατεβάσαμε λοιπόν από την σελίδα 2bx6yarg76ryzjdpegl5l76skdlb4vvxwjxpipq4nhz3xnjjh3jo6qyd.onion/sekritbackup1843/ τα .gpg αρχεία και εστιάσαμε στο αρχείο notes.txt για το πως να τα κάνουμε decrypt. Googlάροντας την λέξη ropsten είδαμε ότι χρησιμοποιείται στο blockchain του Ethereum crypto. Πηγαίνοντας λοιπόν στην σελίδα https://ropsten.etherscan.io/ και τοποθετώντας το hash που είχε το αρχείο notes.txt πήραμε την λέξη bigtent, κοιτώντας τα σχόλια του transaction. Άρα υποψιαστήκαμε ότι πιθανότατα αυτό είναι το secret string από το key που θέλουμε. Εκτελώντας λοιπόν μια brute force μέθοδο (την οποία μπορείτε να δείτε στο decrypt.py αρχείο του φακέλου george_files) παρατηρήσαμε ότι φαίνεται να γίνεται προσπάθεια για decrypt με την ημερομηνία: 2021-01-04. Αφού αλλάξαμε λίγο την σύνταξη για την decrypt εντολή πήραμε λοιπόν τα decrypted αρχεία.

Στην συνέχεια μελετήσαμε το signal.log αρχείο και καταλάβαμε ότι το επόμενο βήμα θα είναι σε κάποιο git repo. Το σχετικό repo το βρήκαμε ανοίγωντας το firefox.log αρχείο (όχι με ιδιαίτερη ευκολία). Ψάχνοντας για κάτι διαφορετικό από το wiki link του Conversation, με search and replace βρήκαμε το επιθημητό repo: https://github.com/asn-d6/tor. Προσθέτοντας και το commit: 4ec3bbea5172e13552d47ff95e02230e6dc99692 βρήκαμε τα σχόλια για το επόμενο βήμα.

Οι παραμέτροι στα σχόλια μας θύμησαν τον RSA αλγόριθμο κρυπτογράφησης οπότε ανοίξαμε τις διαφάνειες του μαθήματος για περαιτέρω. Αφού βρήκαμε τους πρώτους αριθμούς που χρειαζόμασταν (με την χρήση του prime_finder.py του φακέλου george_files) και τον παράγοντα e^-1 από το site: https://www.dcode.fr/modular-inverse κάναμε decode τους αριθμούς Ε(x) και Ε(y) με την βοήθεια του site: https://www.dcode.fr/rsa-cipher. Έτσι πήραμε τους αριθμούς 306 για το x και 3537 για το y. Εν τέλη, από το link: aqwlvm4ms72zriryeunpo3uk7myqjvatba4ikl3wy6etdrrblbezlfqd.onion/30637353063735.txt, βρήκαμε τον Γιώργο στην τοποθεσία Gilman's Point στο Kilimanjaro, Tanzania. 

2. Ποιος έκλεψε τα αρχεία του "Plan X";

Επιστρέψαμε λοιπόν στο Blog entry #2 της Υβόννης και εκεί είδαμε το που μπορούμε να βρούμε τον source code για τον Plan X server (zwt6vcp6d5tao7tbe3je6a2q4pwdfqli62ekuhjo55c7pqlet3brutqd.onion). Ανοίξαμε το chatziko/pico στο Github και το κάναμε clone και στην συνέχεια make για να δούμε αν θα γίνει τίποτα ενδιαφέρον αν προσπαθήσουμε να τον εγκαταστήσουμε στον δικό μας υπολογιστή.

Εκεί παρατηρήσαμε το warning για το format string parameter. Αναζητήσαμε λοιπόν τρόπους για τον αν μπορεί να γίνει κάπως exploit με το format string. Αφού βρήκαμε κάποια πολύ βοηθητικά links (ιδιαίτερη αναφορά σε https://owasp.org/www-community/attacks/Format_string_attack και https://cs155.stanford.edu/papers/formatstring-1.2.pdf) δοκιμάσαμε ως user input να δώσουμε κάτι της μορφής %08x.%08x.%08x.%08x.%08x%s%s έτσι ώστε να πάρουμε κάποιους παραμέτρους από την στοίβα σε δεκαεξαδική μορφή και ταυτόχρονα να τους μετατρέψουμε σε string (με το %s). Έτσι στο 'Invalid user: ' string είδαμε το πρώτο entry του πίνακα users. Από εκεί βρήκαμε το username: admin και το md5'd password το περάσαμε από ένα md5 cracker (https://crackstation.net/) και πήραμε την τιμή: bob's your uncle.

Εν τέλη, μάθαμε ότι τα αρχεία του Plan X τα είχαν κλέψει οι επίδοξοι hackers με όνομα 5l0ppy 8uff00n5 και ευθημήσαμε γιατί η defaced σελίδα μας θύμισε την σελίδα που είχαμε δει στην 1η Απριλίου του μαθήματος μας (την οποία ένα μέλος από εμάς είχε προτείνει ως easter egg :)). Μετά βέβαια, προσγειωθήκαμε γιατί θυμηθήκαμε ότι το 3ο ερώτημα απαιτεί παραπάνω effort από όσα είχαμε δει μέχρι τώρα...

 


